{% extends 'base.html' %}
{% load static %}

{% block title %}é¦–é¡µ - æ¨±èŠ±æŠ€æœ¯åšå®¢{% endblock %}

{% block content %}
<div class="container">
    <!-- ç‰¹è‰²æ–‡ç« æ»‘å— -->
    {% if featured_posts %}
    <section class="featured-slider">
        <div class="slider-container">
            {% for featured in featured_posts %}
            <div class="slider-slide">
                <div class="slider-content">
                    <span class="featured-badge">
                        <i class="fas fa-star"></i> ç‰¹è‰²æ–‡ç« 
                    </span>
                    <h2 class="slider-title">{{ featured.title }}</h2>
                    <p class="slider-excerpt">{{ featured.excerpt|truncatechars:150 }}</p>
                    <a href="{% url 'blog:post_detail' featured.slug %}" class="slider-btn">
                        é˜…è¯»å…¨æ–‡ <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                <div class="slider-image" style="background: linear-gradient(135deg, #FBCFE8 0%, #E0F2FE 100%);">
                    {% if featured.cover_image %}
                    <div style="width: 100%; height: 100%; background-size: cover; background-position: center; background-image: url('{{ featured.cover_image.url }}');"></div>
                    {% else %}
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 5rem; opacity: 0.3;">
                        ğŸŒ¸
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        {% if featured_posts|length > 1 %}
        <button class="slider-nav prev"><i class="fas fa-chevron-left"></i></button>
        <button class="slider-nav next"><i class="fas fa-chevron-right"></i></button>
        <div class="slider-controls"></div>
        {% endif %}
    </section>
    {% endif %}

    <div style="display: grid; grid-template-columns: 1fr 320px; gap: 2rem; margin-top: 2rem;">
        <!-- æ–‡ç« åˆ—è¡¨ -->
        <div class="posts-section">
            <h2 style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-feather-alt" style="color: var(--color-gold);"></i>
                æœ€æ–°æ–‡ç« 
            </h2>

            <div class="post-grid" style="grid-template-columns: 1fr;">
                {% for post in posts %}
                <div class="post-card fade-in stagger-{{ forloop.counter }}">
                    <div class="post-card-image" style="background: linear-gradient(135deg, #FBCFE8 0%, #E0F2FE 100%);">
                        {% if post.category %}
                        <span class="post-card-category">{{ post.category.name }}</span>
                        {% endif %}
                        {% if post.cover_image %}
                        <div style="width: 100%; height: 100%; background-size: cover; background-position: center; background-image: url('{{ post.cover_image.url }}');"></div>
                        {% endif %}
                    </div>
                    <div class="post-card-content">
                        <h3 class="post-card-title">
                            <a href="{% url 'blog:post_detail' post.slug %}">{{ post.title }}</a>
                        </h3>
                        <p class="post-card-excerpt">{{ post.excerpt|truncatechars:120 }}</p>
                        <div class="post-card-meta">
                            <span><i class="fas fa-user"></i> {{ post.author.username }}</span>
                            <span><i class="fas fa-calendar"></i> {{ post.published_at|date:"Y/m/d" }}</span>
                            <span><i class="fas fa-eye"></i> {{ post.views }}</span>
                        </div>
                    </div>
                </div>
                {% empty %}
                <p style="text-align: center; color: var(--color-text-muted); padding: 3rem;">
                    æš‚æ— æ–‡ç« ï¼Œæ•¬è¯·æœŸå¾…ï¼
                </p>
                {% endfor %}
            </div>

            <!-- åˆ†é¡µ -->
            {% if page_obj.has_other_pages %}
            <div class="pagination">
                {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}"><i class="fas fa-chevron-left"></i></a>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                <span class="active">{{ num }}</span>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <a href="?page={{ num }}">{{ num }}</a>
                {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}"><i class="fas fa-chevron-right"></i></a>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <!-- ä½œè€…å¡ç‰‡ -->
            <div class="sidebar-widget author-card">
                <div class="author-avatar">ğŸŒ¸</div>
                <h3 class="author-name">æ¨±èŠ±å°‘å¥³</h3>
                <p class="author-bio">çƒ­çˆ±æŠ€æœ¯ï¼Œçƒ­çˆ±ç¼–ç¨‹çš„äºŒæ¬¡å…ƒå°‘å¥³ã€‚ä¸“æ³¨äºPythonã€Djangoå’ŒWebå¼€å‘ã€‚</p>
                <div style="margin-top: 1rem;">
                    <a href="{% url 'blog:about' %}" class="slider-btn" style="font-size: 0.9rem;">äº†è§£æ›´å¤š</a>
                </div>
            </div>

            <!-- æ ‡ç­¾äº‘ -->
            <div class="sidebar-widget">
                <h3 class="sidebar-title">æ ‡ç­¾äº‘</h3>
                <div class="tag-cloud">
                    {% for tag in popular_tags %}
                    <a href="{% url 'blog:tag' tag.slug %}" class="tag tag-{% if forloop.counter <= 3 %}large{% endif %}">{{ tag.name }}</a>
                    {% endfor %}
                </div>
            </div>

            <!-- ç³»åˆ—æ–‡ç«  -->
            {% if series_list %}
            <div class="sidebar-widget">
                <h3 class="sidebar-title">æ–‡ç« ç³»åˆ—</h3>
                <ul style="list-style: none;">
                    {% for series in series_list %}
                    <li style="margin-bottom: 0.75rem;">
                        <a href="{% url 'blog:series' series.slug %}" style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-book" style="color: var(--color-gold);"></i>
                            {{ series.name }}
                            <span style="color: var(--color-text-muted); font-size: 0.85rem;">({{ series.post_count }})</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- çƒ­é—¨æ–‡ç«  -->
            {% if popular_posts %}
            <div class="sidebar-widget">
                <h3 class="sidebar-title">çƒ­é—¨æ–‡ç« </h3>
                <ul style="list-style: none;">
                    {% for popular in popular_posts %}
                    <li style="margin-bottom: 0.75rem;">
                        <a href="{% url 'blog:post_detail' popular.slug %}" style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; background: var(--color-gold); color: white; border-radius: 50%; font-size: 0.75rem;">
                                {{ forloop.counter }}
                            </span>
                            {{ popular.title|truncatechars:25 }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- è®¢é˜… -->
            <div class="sidebar-widget" style="background: linear-gradient(135deg, var(--color-sakura) 0%, var(--color-sky) 100%);">
                <h3 class="sidebar-title" style="border-color: var(--color-white);">è®¢é˜…æ›´æ–°</h3>
                <p style="margin-bottom: 1rem; color: var(--color-text);">è·å–æœ€æ–°æ–‡ç« æ¨é€</p>
                <form action="{% url 'newsletter:subscribe' %}" method="post" class="newsletter-form" style="flex-direction: column;">
                    {% csrf_token %}
                    <input type="email" name="email" placeholder="è¾“å…¥é‚®ç®±åœ°å€" required style="width: 100%;">
                    <button type="submit" style="width: 100%; margin-top: 0.5rem; border-radius: var(--radius-full);">è®¢é˜…</button>
                </form>
            </div>
        </aside>
    </div>
</div>
{% endblock %}
